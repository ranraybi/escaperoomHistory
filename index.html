<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¤×¢× ×— ×¦×¤× ×™× - ××¨×›×™×•×Ÿ ×”×™×¡×˜×•×¨×™</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=Assistant:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { 
            background: #1a1c1a;
            background-image: radial-gradient(#2d332d 1px, transparent 1px);
            background-size: 20px 20px;
            font-family: 'Assistant', sans-serif;
            display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0;
            color: #d1d5db;
        }

        .archive-case {
            background: #2b2f2b;
            border: 4px solid #3f453f;
            box-shadow: 0 0 0 2px #1a1c1a, 0 20px 50px rgba(0,0,0,0.8);
            position: relative;
        }

        .paper-slot {
            background: #c2b280;
            background-image: url('https://www.transparenttextures.com/patterns/pinstriped-suit.png');
            box-shadow: inset 0 5px 15px rgba(0,0,0,0.5);
            border-bottom: 3px solid #8e7d4b;
        }

        .typewriter-font { font-family: 'Special Elite', cursive; }

        .rusty-btn {
            background: linear-gradient(145deg, #3a3f3a, #232723);
            border: 1px solid #1a1c1a;
            box-shadow: 3px 3px 0 #151815;
            color: #a7adba;
            transition: all 0.1s;
        }

        .rusty-btn:active:not(:disabled) {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 #151815;
        }

        .stamp {
            border: 3px double #7f1d1d;
            color: #7f1d1d;
            transform: rotate(-15deg);
            font-weight: bold;
            text-transform: uppercase;
            padding: 2px 8px;
            opacity: 0.7;
            display: inline-block;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.2s ease-in-out 2; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function HistoricalLock() {
            const SECRET_CODE = "46345";
            const MAX_ATTEMPTS = 3;
            const LOCKOUT_DURATION = 30; // ×©× ×™×•×ª

            const [input, setInput] = useState("");
            const [status, setStatus] = useState("idle"); 
            
            // ×˜×¢×™× ×ª × ×™×¡×™×•× ×•×ª ××”×–×™×›×¨×•×Ÿ
            const [attempts, setAttempts] = useState(() => {
                return parseInt(localStorage.getItem('archive_attempts')) || 0;
            });

            // ×‘×“×™×§×” ×× ×”××©×ª××© ×”×™×” ×‘×—×¡×™××” ×œ×¤× ×™ ×¨×™×¢× ×•×Ÿ ×”×“×£
            const [lockoutTimer, setLockoutTimer] = useState(() => {
                const savedExpiry = localStorage.getItem('archive_lock_expiry');
                if (savedExpiry) {
                    const remaining = Math.ceil((parseInt(savedExpiry) - Date.now()) / 1000);
                    return remaining > 0 ? remaining : 0;
                }
                return 0;
            });

            // × ×™×”×•×œ ×˜×™×™××¨ ×”×—×¡×™××”
            useEffect(() => {
                let interval;
                if (lockoutTimer > 0) {
                    setStatus("locked");
                    interval = setInterval(() => {
                        setLockoutTimer(prev => {
                            const newValue = prev - 1;
                            if (newValue <= 0) {
                                // ×©×—×¨×•×¨ ×—×¡×™××”
                                setAttempts(0);
                                setStatus("idle");
                                localStorage.removeItem('archive_lock_expiry');
                                localStorage.setItem('archive_attempts', '0');
                                return 0;
                            }
                            return newValue;
                        });
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [lockoutTimer]);

            const handleNumber = (n) => {
                if (status !== "idle" || input.length >= 5) return;
                setInput(prev => prev + n);
            };

            const onVerify = () => {
                if (input.length < 5 || status !== "idle") return;
                
                setStatus("loading");
                
                setTimeout(() => {
                    if (input === SECRET_CODE) {
                        setStatus("success");
                        setAttempts(0);
                        localStorage.setItem('archive_attempts', '0');
                        localStorage.removeItem('archive_lock_expiry');
                        confetti({ 
                            particleCount: 150, 
                            spread: 70, 
                            colors: ['#4b5320', '#c2b280', '#ffd700'] 
                        });
                    } else {
                        const newAttempts = attempts + 1;
                        setAttempts(newAttempts);
                        localStorage.setItem('archive_attempts', newAttempts.toString());

                        if (newAttempts >= MAX_ATTEMPTS) {
                            const expiry = Date.now() + (LOCKOUT_DURATION * 1000);
                            localStorage.setItem('archive_lock_expiry', expiry.toString());
                            setLockoutTimer(LOCKOUT_DURATION);
                            setStatus("locked");
                            setInput("");
                        } else {
                            setStatus("error");
                            setTimeout(() => { 
                                setStatus("idle"); 
                                setInput(""); 
                            }, 1200);
                        }
                    }
                }, 1200);
            };

            return (
                <div className={`archive-case p-6 rounded-sm w-full max-w-sm ${status === 'error' ? 'shake' : ''}`}>
                    <div className="absolute top-2 right-2 stamp text-[10px] typewriter-font">×¡×•×“×™ ×‘×™×•×ª×¨</div>
                    
                    <div className="text-center mb-6">
                        <div className="w-16 h-16 bg-[#1a1c1a] border-2 border-[#3f453f] rounded-full mx-auto flex items-center justify-center mb-2 shadow-inner">
                            <span className="text-2xl grayscale">
                                {status === 'success' ? 'ğŸ”“' : status === 'locked' ? 'â³' : 'ğŸ”’'}
                            </span>
                        </div>
                        <h1 className="typewriter-font text-xl text-gray-300">×¤×¢× ×•×— ××¡××š ××¡×•×•×’</h1>
                        <div className="flex flex-col gap-1 mt-2">
                            <p className="text-[10px] text-gray-500 uppercase tracking-widest">××“×•×¨ ×”×™×¡×˜×•×¨×™×”</p>
                            <p className="text-xs font-bold text-amber-600/70 uppercase">
                                × ×™×¡×™×•× ×•×ª: {attempts} / {MAX_ATTEMPTS}
                            </p>
                        </div>
                    </div>

                    <div className="paper-slot p-5 rounded-sm mb-6 relative overflow-hidden">
                        <div className="flex justify-center gap-4 text-black text-4xl typewriter-font font-bold" dir="ltr">
                            {input.padEnd(5, 'â€¢').split('').map((char, i) => (
                                <span key={i} className={i < input.length ? (status === 'error' ? 'text-red-700' : 'text-black') : 'opacity-20'}>
                                    {char}
                                </span>
                            ))}
                        </div>
                    </div>

                    <div className="grid grid-cols-3 gap-3 mb-6" dir="ltr">
                        {[1, 2, 3, 4, 5, 6, 7, 8, 9, 'C', 0, 'âŒ«'].map(k => (
                            <button 
                                key={k}
                                disabled={status !== 'idle'}
                                onClick={() => {
                                    if (k === 'C') setInput("");
                                    else if (k === 'âŒ«') setInput(p => p.slice(0, -1));
                                    else handleNumber(k.toString());
                                }}
                                className="rusty-btn h-14 rounded-sm text-xl typewriter-font disabled:opacity-20 disabled:cursor-not-allowed"
                            >{k}</button>
                        ))}
                    </div>

                    <button 
                        onClick={onVerify}
                        disabled={status !== 'idle' || input.length < 5}
                        className={`w-full py-4 rounded-sm typewriter-font font-bold text-lg border-2 border-black shadow-lg transition-all
                            ${status === 'success' ? 'bg-green-900 text-white border-green-400' : 'bg-[#4b5320] text-gray-200 hover:bg-[#565e25]'}
                            disabled:opacity-40 disabled:grayscale active:bg-black`}
                    >
                        {status === 'loading' ? '××¤×¢× ×—...' : status === 'locked' ? `××•×©×‘×ª (${lockoutTimer} ×©× ')` : '×××ª ×¦×•×¤×Ÿ'}
                    </button>

                    {status === 'error' && (
                        <p className="text-center text-red-900 mt-4 typewriter-font text-[10px] font-bold uppercase bg-red-200/20 py-1 rounded">
                            ×©×’×™××ª ×¤×¢× ×•×—: × ×•×ª×¨×• {MAX_ATTEMPTS - attempts} ×”×–×“×× ×•×™×•×ª
                        </p>
                    )}

                    {status === 'locked' && (
                        <p className="text-center text-amber-500 mt-4 typewriter-font text-[10px] font-bold uppercase animate-pulse">
                            ××‘×˜×—×” ×”×•×¤×¢×œ×”. ×”××ª×Ÿ ×œ×©×—×¨×•×¨ ×”××¢×¨×›×ª.
                        </p>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<HistoricalLock />);
    </script>
</body>
</html>
